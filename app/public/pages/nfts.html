<div>
  <div class="hidden">
    <label for="nftAuctionContractAddress">NFT Auction Contract Addy:</label>
    <input id="nft_auction_contract" name="nftAuctionContractAddress" type="text"></input><br />
    <button id="nft_contract_check_approval">Check Approval</button>
  </div>

  <div id="ntf_auction_set_approval_container" class="approve-wolvercoin-container">
    <button id="nft_auction_set_approval_button" class="approve-wolvercoin-button hidden">Approve Wolvercoin</button>
  </div>
</div>

<script>
  let hasApprovalForHWToken = false;

  // Get the nft auction contract address
  let auctionContractAddress = "0x13066EE900a8C4e2C9cD7cE0096ADF9B907D0CfF";
  let inputAddress = $("#nft_auction_contract").val();
  if (inputAddress.length == auctionContractAddress.length) {
    auctionContractAddress = inputAddress;
  }

  function showApproval() {
    $('#nft_auction_set_approval_button').show();
  }

  /*
   *  Checks to see if the auction contract is allowed to spend Wolvercoin
   *    - If yes, updates UI to allow bidding
   *    - If no, shows 'approve spend of wolvercoin'
   */
  async function checkAllowance() {
    console.log('checking allowance');

    // Check for approval, if so, show a different UI
    var web3 = new Web3(Web3.givenProvider || 'ws://some.local-or-remote.node:8546');
    const WolvercoinContract = new web3.eth.Contract(ECR20_WVCABI, WVC_ADDRESS.goerli);

    let allowance = null;
    // allowance takes (owner, spender) so (msg.sender, contractToSpend)
    await WolvercoinContract.methods.allowance(ethereum.selectedAddress, auctionContractAddress).call(async function(err, res) {
      console.log(err, res);

      // Call method to handle approved items or not
      if (res == '115792089237316195423570985008687907853269984665640564039457584007913129639935') { // show bidding options
        console.log('approval granted');
      } else { // show 'approve hw coin'
        await WolvercoinContract.methods.balanceOf(ethereum.selectedAddress).call(function(err, res) {
          // If they don't have wolvercoin, no need to approve
          if (res != "0") {
            showApproval();
          }
        });

      }
    });
  }
  checkAllowance();

  async function approveWolvercoin() {
    // Check for approval, if so, show a different UI
    var web3 = new Web3(Web3.givenProvider || 'ws://some.local-or-remote.node:8546');
    const WolvercoinContract = new web3.eth.Contract(ECR20_WVCABI, WVC_ADDRESS.goerli);
    let approve_amount = '115792089237316195423570985008687907853269984665640564039457584007913129639935'; //(2^256 - 1 )
    await WolvercoinContract.methods.approve(auctionContractAddress, approve_amount).send({
      from: ethereum.selectedAddress
    });

    checkAllowance();
  }
  $('#nft_auction_set_approval_button').click(function() {
    approveWolvercoin();
  });
</script>